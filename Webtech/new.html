<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>New Record</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
<div class="container">
    <div class="topbar-right">
    <span id="userName" class="user-name"></span>
    <button id="logoutBtn" class="btn subtle">Logout</button>
  </div>
    <header>
        <h1>Create New Facility Record</h1>
        <div class="btn-group">
            <a href="index.html" class="btn">Home</a>
            <a href="search.html" class="btn">Search</a>
            <a href="update.html" class="btn">Update</a>
            <a href="delete.html" class="btn">Delete</a>
        </div>
    </header>

    <section class="card">
        <form id="newForm">
            <div class="form-grid">
                <div class="input-group">
                    <label for="newCode">Facility Code</label>
                    <input type="text" id="newCode" required>
                </div>
                <div class="input-group">
                    <label for="newName">Facility Name</label>
                    <input type="text" id="newName" required>
                </div>
                <div class="input-group">
                    <label for="newSite">Site</label>
                    <input type="text" id="newSite" required>
                </div>
                <div class="input-group">
                    <label for="newSubmitter">Submitter</label>
                    <input type="text" id="newSubmitter" required>
                </div>
            </div>
            <button type="submit" class="btn">Create</button>
            <button type="reset" class="btn secondary">Clear</button>
        </form>
    </section>
</div>

<script>
document.getElementById('newForm').addEventListener('submit', function(e) {
    e.preventDefault();

    const code = document.getElementById('newCode').value.trim();
    const name = document.getElementById('newName').value.trim();
    const site = document.getElementById('newSite').value.trim();
    const submitter = document.getElementById('newSubmitter').value.trim();

    if (!code || !name || !site || !submitter) {
        alert('Please fill out all fields.');
        return;
    }

    let records = JSON.parse(localStorage.getItem('facilities')) || [];

    const exists = records.some(r => r.code === code);
    if (exists) {
        alert('Facility code already exists.');
        return;
    }

    const newRecord = {
        code,
        name,
        site,
        submitter,
        updated: new Date().toLocaleDateString()
    };

    records.push(newRecord);
    localStorage.setItem('facilities', JSON.stringify(records));

    alert('Record added successfully.');
    this.reset();
});

function setupLogout() {
  const logoutBtn = document.getElementById('logoutBtn');
  logoutBtn.addEventListener('click', () => {
    localStorage.removeItem('rms_user');
    window.location.href = 'login.html';
  });
}

function showUser() {
  const user = JSON.parse(localStorage.getItem('rms_user'));
  const userNameSpan = document.getElementById('userName');
  if (user && user.name) {
    userNameSpan.textContent = `Welcome, ${user.name}`;
  } else {
    window.location.href = 'login.html';
  }
}

window.onload = function() {
  showUser();
  setupLogout();
};
</script>
</body>
</html>
